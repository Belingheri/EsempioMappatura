<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - KMZ</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <script
      type="text/javascript"
      src="../../node_modules/jquery/dist/jquery.min.js"
    ></script>
    <link type="text/css" rel="stylesheet" href="main.css" />
  </head>
  <body>
    <!--div id="info">
			<a href="https://threejs.org" target="_blank" rel="noopener">three.js</a>
			-
			<a
				href="https://developers.google.com/kml/documentation/kmzarchives"
				target="_blank"
				rel="noopener"
				>KMZ</a
			>
			loader
		</div-->

    <script type="module">
      import * as THREE from "../build/three.module.js";

      import { OrbitControls } from "./jsm/controls/OrbitControls.js";
      import { KMZLoader } from "./jsm/loaders/KMZLoader.js";

      var camera, scene, renderer;

      init();

      function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x999999);

        var light = new THREE.DirectionalLight(0xffffff);
        light.position.set(0.5, 1.0, 0.5).normalize();
        scene.add(light);

        camera = new THREE.PerspectiveCamera(
          35,
          window.innerWidth / window.innerHeight,
          1,
          500
        );

        camera.position.y = 5;
        camera.position.z = 10;

        scene.add(camera);

        var grid = new THREE.GridHelper(50, 50, 0xffffff, 0x555555);
        scene.add(grid);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        /*
        setTimeout(() => {
          var loader = new KMZLoader();
          loader.load("./models/kmz/Box.kmz", function (kmz) {
            kmz.scene.position.y = 0.5;
            kmz.scene.position.x = 6.5;
            scene.add(kmz.scene);
            render();
          });

          loader = new KMZLoader();
          loader.load("./models/kmz/Box.kmz", function (kmz) {
            kmz.scene.position.y = 0.5;
            kmz.scene.position.x = 10;
            scene.add(kmz.scene);
            render();
          });
		}, 100);
*/
        $.getJSON("../../data/data1.json", (data) => {
          data.magazzino.forEach((element) => {
            const loader = new KMZLoader();
            loader.load("./models/kmz/Box.kmz", function (kmz) {
              kmz.scene.position.y = 0.5;
              kmz.scene.position.x = element.x / 2 - 25.5;
              kmz.scene.position.z = element.y / 2 - 25.5;
              console.log(kmz.scene.position);
              scene.add(kmz.scene);
              render();
            });
          });
        });

        render();
        var controls = new OrbitControls(camera, renderer.domElement);
        controls.addEventListener("change", render);
        controls.update();

        window.addEventListener("resize", onWindowResize, false);
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);

        render();
      }

      function render() {
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
